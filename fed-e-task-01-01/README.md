# 模块一：函数式编程与 JS 异步编程、手写 Promise简答题

## 一. 异步编程，EventLoop和消息队列

​	JavaScript是一门单线程的语言，就是任务只能排队一件一件的完成。这个模式的坏处在于如果其中有一个任务耗时很长，那么后面的任务必须等待，导致整个页面卡在此处，其它任务无法执行。

​	为了解决这个问题，Javascript语言将任务的执行模式分成两种：同步（Synchronous）和异步（Asynchronous）。

​	异步编程就是一个任务分成两段，先执行第一段，然后转而执行其他任务，等做好了准备，再回过头执行第二段。排在异步任务后面的代码，不用等待异步任务结束会马上运行，也就是说，异步任务不具有”堵塞“效应。

​	而异步模式的出现就是为了解决这个问题，JavaScript虽然是单线程的，但浏览器不是。异步模式使JavaScript遇到异步代码时，将异步代码挂起交给Web APIs处理，JavaScript继续执行。同时，Web APIs中执行异步任务，如果任务完成，该任务将按顺序依次放入消息队列中。

​	当JavaScript执行到最后，我们发现调用栈中已经没有了需要执行的函数，但是消息队列中还有，那么怎么使Web APIs已经挂载完成的函数回到调用栈呢，这时Event Loop就出现了

​	Event Loop是一个程序结构，用于等待和发送消息和事件。当调用栈中已经没有了需要执行的函数，但是消息队列中还有时，Event Loop会监听到并将消息队列的函数调回调用栈，JavaScript将执行这些函数，相当于开启了新一轮的执行。如果新一轮函数又有异步任务，那么还是按之前逻辑处理。

​	听起来好像有点绕，让我们换个形象点的例子说一下。JavaScript就像一个人刚开始创业，他能力很强但毕竟孤身一人，项目只能一件一件做，许多项目又需要耗费大量时间来市场调研和计划准备，导致自身很累效益也不高，吃力又不讨好。

​	他觉得这不是长久之计，于是成立一个公司，将耗时的市场调研和计划准备工作（异步任务）交给了员工（Web APIs）来做，同时招了一个秘书（Event Loop）来和他对接。他先完成自己手头上紧急的工作，等工作全部完成之后，秘书跑过来进行汇报：“boss，异步任务1和异步任务2准备工作已经完成了，请你过目”。JavaScript拿过计划书直接开始新一轮的忙碌，虽然谈不上轻松，但相较之前显得井井有条，他不禁感慨“团队合作才是成功之道”。

## 二. 宏任务和微任务

先说一下概念：

​	宏任务：回调队列中的任务

​	微任务：直接在当前任务结束过后立即执行的任务

单独看概念好像依然不能太好理解，让我们依然举上面那个例子：

​	这一天，JavaScript像往常一样工作，突然P总（Promise）给他打了个电话，说上次做的网站很好但有几个页面需要进行修改（微任务）。JavaScript心想这并不困难，不用再有准备工作了，同时P总也是老客户了，不能让他久等，于是答应下来并承诺在手上事情忙完就马上开始这个工作（微任务执行顺序在新一轮宏任务之前）

​	总结一下，大体执行顺序就是：同步任务（第一轮宏任务）--->Promise（微任务）--->消息队列（第二轮宏任务）

​	

​	